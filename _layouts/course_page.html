<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-US" }}">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

{% seo %}
    <link rel="stylesheet" href="{{ "/assets/css/style.css?v=" | append: site.github.build_revision | relative_url }}">
    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->
    {% include head-custom.html %}
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/python.min.js"></script>
    <style>
  /* Define base styles */
  :root {
    --base-background-color: #ffffff;
    --base-text-color: #444444;
    --accent-color: #DD4C4F;
    --highlight-color: #D3FFA4;
  }

  body {
    font-family: "AvenirNext-Regular", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    font-size: 15px;
    background-color: var(--base-background-color);
    color: var(--base-text-color);
    line-height: 1.6;
    margin: 0;
    padding: 0;
    font-weight: 300;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

    /* Image and text wrapper */
  .image-text-wrapper {
    display: flex;
    align-items: flex-start;
    margin-bottom: 1.5em;
  }

  .image-text-wrapper img {
    float: left; /* Float the image to the left */
    width: 110px;
    height: auto;
    border-radius: 0%;
    margin-right: 20px; /* Create space between image and text */
  }

  .image-text-wrapper div {
    text-align: justify;
  }

  /* Style for the wrapper to center the content */
  .wrapper {
    max-width: 650px; /* Maintain content width */
    margin: 0 auto;
    padding: 2em 5%;
    background-color: var(--base-background-color);
    text-align: left;
    font-weight: 300;
  }

  /* Ensure text respects new lines and spaces */
  p, li, a, blockquote {
    white-space: normal;
    word-break: normal;
    margin: 0;
    text-align: left;
  }

  /* Style links to prevent changes on hover */
  a {
    color: var(--accent-color);
    text-decoration: none;
    font-weight: 300; /* Ensure consistent font weight */
  }

  /* Disable font weight change on hover */
  a:hover {
    color: var(--accent-color); /* Keep link color the same on hover */
    text-decoration: none; /* No underline on hover */
    font-weight: 300; /* Explicitly set the font weight to prevent bolding */
  }

  /* Additional styling for headings */
  h1, h2, h3, h4, h5, h6 {
    font-family: "AvenirNext-Medium", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    margin-top: 1em;
    margin-bottom: 0.5em;
    font-weight: 400;
    scroll-margin-top: 100px;  /* Enough space to clear the header */
  }

  /* Style for blockquotes */
  blockquote {
    color: var(--base-text-color);
    border-left: 4px solid var(--accent-color);
    padding-left: 1em;
    margin: 1em 0;
    font-weight: 300; /* Make blockquotes lighter */
  }

  /* Responsive adjustments for all devices */
  @media screen and (max-width: 768px) {
    body {
      font-size: 14px;
    }

    .wrapper {
      padding: 1em 5%;
    }

    h1, h2, h3, h4, h5, h6 {
      margin-top: 0.75em;
      margin-bottom: 0.5em;
    }

    p, li, blockquote {
      margin: 0.75em 0;
    }
  }

  @media screen and (max-width: 480px) {
    body {
      font-size: 13px;
    }

    .wrapper {
      padding: 1em;
    }

    em, i {
      font-weight: 500;
    }

    p, li, blockquote {
      margin: 0.5em 0;
    }
  }

  /* Ensure content is always visible and scrollable */
  html, body {
    overflow-x: hidden;
    width: 100%;
    -webkit-overflow-scrolling: touch;
  }

  /* Improve touch and click targets on mobile */
  a, button {
    min-height: 44px;
    min-width: 44px;
  }

  /* Improve readability on high-DPI screens */
  @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    body {
      -webkit-font-smoothing: subpixel-antialiased;
    }
  }

  /* Add styles for dynamic content */
  .course-content {
    margin-top: 2em;
    color: var(--base-text-color);
  }

  .course-content h1,
  .course-content h2,
  .course-content h3,
  .course-content h4,
  .course-content h5,
  .course-content h6 {
    color: var(--base-text-color);
    font-family: "AvenirNext-Medium", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  }

  .course-content a {
    color: var(--accent-color);
    text-decoration: none;
    font-weight: 300;
  }

  .course-content a:hover {
    color: var(--accent-color);
    text-decoration: none;
    font-weight: 300;
  }

  .course-content p {
    margin: 0.8em 0;
    line-height: 1.5;
  }

  .course-content ul,
  .course-content ol {
    margin: 0;
    padding-left: 1.5em;
    list-style-position: outside;
  }

  .course-content li {
    margin: 0;
    line-height: 1.4;
    padding-left: 0.2em;
  }

  .course-content li p {
    margin: 0;
  }

  .course-content h1,
  .course-content h2,
  .course-content h3,
  .course-content h4 {
    margin-top: 1.5em;
    margin-bottom: 0.5em;
  }

  /* Handle indented lists */
  .course-content ul ul,
  .course-content ul ol,
  .course-content ol ul,
  .course-content ol ol {
    margin: 0;
    padding-left: 1.2em;
  }

  /* Ensure proper alignment of list markers */
  .course-content ul {
    list-style: disc outside none;
  }

  .course-content ul ul {
    list-style-type: circle;
  }

  /* Keep blockquote styles */
  blockquote {
    margin: 1em 0;
    padding: 0 1em;
    color: #656d76;
    border-left: 0.25em solid #DD4C4F;
  }

  blockquote > :first-child {
    margin-top: 0;
  }

  blockquote > :last-child {
    margin-bottom: 0;
  }

  /* Update header styles for floating */
  .page-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    width: 100%;
    z-index: 1000;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(5px);
    border-bottom: none;
  }

  /* Add inner container for header content */
  .header-content {
    max-width: 650px;
    margin: 0 auto;
    padding: 1em 5%;  /* Match wrapper padding */
  }

  /* Wrapper styles */
  .wrapper {
    max-width: 650px;
    margin: 0 auto;
    padding: 2em 5%;
  }

  /* Mobile adjustments */
  @media screen and (max-width: 768px) {
    .header-content {
      padding: 1em 5%;  /* Keep consistent padding */
    }
    
    .page-header .title {
      font-size: 0.9em;
      line-height: 1.4;
    }
    
    .page-header .links {
      font-size: 0.85em;
      margin-top: 0.5em;
    }
  }

  @media screen and (max-width: 480px) {
    .header-content {
      padding: 1em 5%;  /* Keep consistent padding */
    }
  }

  /* Remove sidebar-related margin */
  .wrapper {
    margin: 0 auto;
    max-width: 650px;
    padding: 2em 5%;
  }

  /* Remove all sidebar-nav related styles */
  .sidebar-nav {
    display: none;
  }

  /* Code block styles - minimal padding */
  pre {
    margin: 1em 0;
    padding: 2px;
    background-color: #f3f3f3;
    border: none;
    border-radius: 0;
    font-size: 85%;
    line-height: 1.45;
    overflow: auto;
    word-wrap: break-word;
    white-space: pre-wrap;
  }

  pre code {
    padding: 0;
    margin: 0;
    border: 0;
    font-family: ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace;
    font-size: inherit;
    line-height: inherit;
    word-wrap: break-word;
    white-space: pre-wrap;
    background-color: #f3f3f3;
  }

  /* Code block styles */
  .code-wrapper {
    position: relative;
    margin: 0;
  }

  /* Copy button styles - centered icons and compact box */
  .copy-button {
    position: absolute;
    top: 2px;
    right: 2px;
    padding: 2px;  /* Reduced from 4px */
    border: none;
    border-radius: 4px;
    cursor: pointer;
    background: transparent;
    transition: background-color 0.2s;
    display: flex;  /* Enable flexbox for centering */
    align-items: center;  /* Center vertically */
    justify-content: center;  /* Center horizontally */
    width: 24px;  /* Fixed width */
    height: 24px;  /* Fixed height */
  }

  .copy-button:hover {
    background-color: #e0e0e0;
  }

  /* Copy icon styles - centered */
  .copy-button svg {
    width: 14px;  /* Slightly smaller icons */
    height: 14px;
    fill: #57606a;
  }

  /* Keep the rest of your copy button styles the same */
  .copy-button .copy-icon {
    display: block;
  }

  .copy-button .check-icon {
    display: none;
    fill: #1a7f37;
  }

  .copy-button.copied .copy-icon {
    display: none;
  }

  .copy-button.copied .check-icon {
    display: block;
  }

  /* Remove any other background colors */
  .highlight {
    background: none;
    padding: 0;
    margin: 0;
    border: none;
  }

  /* Add scroll margin to headings to account for fixed header */
  h1, h2, h3, h4, h5, h6 {
    scroll-margin-top: 100px;  /* Enough space to clear the header */
  }

  /* Update blockquote styles to match GitHub with accent color */
  blockquote {
    margin: 1em 0;
    padding: 0 1em;
    color: #656d76;
    border-left: 0.25em solid #DD4C4F;  /* Match your accent color */
  }

  blockquote > :first-child {
    margin-top: 0;
  }

  blockquote > :last-child {
    margin-bottom: 0;
  }

  /* Remove any conflicting blockquote styles */
  .course-content blockquote,
  blockquote p {
    margin: 0;
    padding: 0;
    color: #656d76;
    font-weight: normal;
    text-align: left;
  }

  /* Ensure proper spacing in blockquotes */
  blockquote p {
    margin: 0.5em 0;
  }

  /* Override any theme-specific borders */
  .highlight pre, 
  .highlight code,
  pre, 
  code {
    border: none !important;
    background-color: #f3f3f3 !important;
  }

  /* Ensure proper paragraph spacing outside lists */
  .course-content p {
    margin: 0.8em 0;
  }

  /* Tighter list spacing */
  .course-content ul,
  .course-content ol {
    margin: 0;
    padding-left: 2em;
  }

  .course-content li {
    margin: 0;
    padding: 0;
    line-height: 1.2;
  }

  .course-content li p {
    margin: 0;
    padding: 0;
    line-height: 1.2;
  }

  /* Keep spacing between lists and other elements */
  .course-content ul + p,
  .course-content ol + p {
    margin-top: 0.8em;
  }

  p + .course-content ul,
  p + .course-content ol {
    margin-top: 0.8em;
  }
</style>

    <!-- Add MathJax -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          processEscapes: true,
          processEnvironments: true
        },
        options: {
          skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
        }
      };
    </script>
    <script type="text/javascript" id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>

    <script>
    async function processGitHubContent(contentDiv) {
      let content = contentDiv.innerHTML;
      
      // First convert the content from base64 if needed
      try {
        content = decodeURIComponent(escape(content));
      } catch (e) {
        console.log('Content already decoded');
      }
      
      // Use DOMParser to properly decode HTML entities
      const parser = new DOMParser();
      const doc = parser.parseFromString(content, 'text/html');
      content = doc.body.textContent;
      
      // Fix smart quotes and other special characters
      content = content
        // Smart quotes and apostrophes
        .replace(/[\u2018\u2019\u201B]/g, "'")
        .replace(/[\u201C\u201D\u201F]/g, '"')
        // Dashes
        .replace(/[\u2013\u2014]/g, '-')
        // Ellipsis
        .replace(/\u2026/g, '...')
        // Additional apostrophe variants
        .replace(/\u02BC/g, "'")
        .replace(/\u02BB/g, "'")
        // HTML entities
        .replace(/&apos;/g, "'")
        .replace(/&quot;/g, '"')
        .replace(/&rsquo;/g, "'")
        .replace(/&lsquo;/g, "'")
        .replace(/&rdquo;/g, '"')
        .replace(/&ldquo;/g, '"')
        .replace(/&mdash;/g, '-')
        .replace(/&ndash;/g, '-')
        .replace(/&nbsp;/g, ' ')
        .replace(/&amp;/g, '&');
      
      // If content starts with '>', it's likely already HTML-encoded
      if (content.includes('&gt;')) {
        content = content.replace(/&gt;/g, '>');
      }
      
      // Configure marked.js
      marked.setOptions({
        gfm: true,
        breaks: true,
        headerIds: true,
        mangle: false
      });
      
      // Process GitHub relative URLs, external links, and images
      content = content.replace(
        /!\[(.*?)\]\((.*?)\)|(?<!!)\[(.*?)\]\((.*?)\)/g,  // Match both images and regular links
        (match, imgAlt, imgUrl, linkText, linkUrl) => {
          // Handle images
          if (match.startsWith('!')) {
            // If it's a relative image URL, prepend the raw GitHub URL
            if (!imgUrl.startsWith('http')) {
              // Get the current section number from the URL if available
              const urlParams = new URLSearchParams(window.location.search);
              const sectionNum = urlParams.get('n');
              
              if (sectionNum) {
                const sectionPath = `section/${sectionNum}/`;
                
                // If it's a relative path starting with ./ or ../, resolve it relative to the current section
                if (imgUrl.startsWith('./') || imgUrl.startsWith('../')) {
                  const resolvedPath = new URL(imgUrl, `https://raw.githubusercontent.com/damek/STAT-4830/main/${sectionPath}`).pathname.slice(1);
                  return `![${imgAlt}](https://raw.githubusercontent.com/damek/STAT-4830/main/${resolvedPath})`;
                }
                
                // For other paths, try section directory first, then fall back to repo root
                if (!imgUrl.startsWith('/')) {
                  return `![${imgAlt}](https://raw.githubusercontent.com/damek/STAT-4830/main/${sectionPath}${imgUrl})`;
                }
              }
              
              // For absolute paths or when not in a section, use from repo root
              const cleanPath = imgUrl.startsWith('/') ? imgUrl.slice(1) : imgUrl;
              return `![${imgAlt}](https://raw.githubusercontent.com/damek/STAT-4830/main/${cleanPath})`;
            }
            return match;  // Keep external image URLs as is
          }
          
          // Handle regular links (using linkText and linkUrl)
          const text = linkText;
          const url = linkUrl;
          
          // Handle PDFs using PDF.js viewer - now works with any directory
          if (url.toLowerCase().endsWith('.pdf')) {
            const rawUrl = url.startsWith('http') ? url : `https://raw.githubusercontent.com/damek/STAT-4830/main/${url}`;
            return `<a href="https://mozilla.github.io/pdf.js/web/viewer.html?file=${encodeURIComponent(rawUrl)}" target="_blank" rel="noopener">${text}</a>`;
          }
          
          // Handle notes links - new format
          if (url.match(/^section\/\d+(?:\.\d+)?\/notes\.md/)) {
            const sectionMatch = url.match(/^section\/(\d+(?:\.\d+)?)\/notes\.md/);
            const sectionNum = sectionMatch[1];
            const hash = url.includes('#') ? '#' + url.split('#')[1] : '';
            return `[${text}](/STAT-4830/section?n=${sectionNum}${hash})`;
          }
          
          // Handle old lecture format for backward compatibility
          if (url.match(/^Lecture\d+\.md/)) {
            const lectureNum = url.match(/Lecture(\d+)\.md/)[1];
            const hash = url.includes('#') ? '#' + url.split('#')[1] : '';
            return `[${text}](/STAT-4830/section?n=${lectureNum}${hash})`;
          }
          
          // Handle toc.md
          if (url === 'toc.md') {
            return `[${text}](/STAT-4830/toc.html)`;
          }
          
          // External links (not starting with / or #)
          if (!url.startsWith('/') && !url.startsWith('#')) {
            return `<a href="${url}" target="_blank" rel="noopener">${text}</a>`;
          }
          
          // Internal links
          return `[${text}](${url})`;
        }
      );
      
      // Parse with marked
      contentDiv.innerHTML = marked.parse(content);
      
      // Process headings
      contentDiv.querySelectorAll('h1, h2, h3, h4').forEach(heading => {
        const id = heading.textContent
          .toLowerCase()
          .replace(/[^\w\s-]/g, '')
          .replace(/\s+/g, '-');
        heading.id = id;
      });
      
      // Add copy buttons
      addCopyButtons();

      // Process math after content is loaded
      if (window.MathJax) {
        try {
          await MathJax.typesetPromise([contentDiv]);
        } catch (error) {
          console.error('MathJax error:', error);
        }
      }
    }

    // Add copy buttons to code blocks
    function addCopyButtons() {
      document.querySelectorAll('pre code').forEach((codeBlock) => {
        const pre = codeBlock.parentNode;
        
        // Create wrapper if not exists
        let wrapper = pre.parentNode;
        if (!wrapper.classList.contains('code-wrapper')) {
          wrapper = document.createElement('div');
          wrapper.className = 'code-wrapper';
          pre.parentNode.insertBefore(wrapper, pre);
          wrapper.appendChild(pre);
        }
        
        // Add copy button
        const button = document.createElement('button');
        button.className = 'copy-button';
        button.setAttribute('aria-label', 'Copy code');
        button.innerHTML = `
          <svg class="copy-icon" aria-hidden="true" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25v-7.5zM5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25v-7.5zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25h-7.5z"></path>
          </svg>
          <svg class="check-icon" aria-hidden="true" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0z"></path>
          </svg>`;
        
        button.onclick = async () => {
          try {
            await navigator.clipboard.writeText(codeBlock.textContent);
            button.classList.add('copied');
            setTimeout(() => {
              button.classList.remove('copied');
            }, 2000);
          } catch (err) {
            console.error('Failed to copy:', err);
          }
        };
        wrapper.appendChild(button);
      });
    }
    </script>
  </head>
  <body>
    <div class="wrapper">
      <header class="page-header">
        <div class="header-content">
          <div class="title">STAT 4830: Numerical Optimization for Data Science and Machine Learning - <a href="https://damekdavis.com">Damek Davis</a></div>
          <div class="links">
            <a href="/STAT-4830/toc.html">Table of contents</a> | 
            <a href="/STAT-4830/index.html">Course overview</a> | 
            <a href="https://github.com/damek/STAT-4830">View on Github</a>
          </div>
        </div>
      </header>

      <div class="toc-wrapper" style="margin-top: 2em;">
        <div id="toc"></div>
      </div>

      <div class="content-wrapper" style="margin-top: 8em;">
        {{ content }}
      </div>

      <script>
        // Configure MathJax rendering for all pages
        document.addEventListener('DOMContentLoaded', function() {
          if (window.MathJax) {
            MathJax.typesetPromise();
          }
        });
      </script>
    </div>
    <script src="{{ "/assets/js/scale.fix.js" | relative_url }}"></script>
  </body>
</html>
